FROM openjdk:17-jdk-slim

RUN mkdir -p /app/uncaught-heroes-backend
RUN mkdir -p /app/uncaught-heroes-backend/src
WORKDIR /app

COPY pom.xml /app
COPY mvnw /app
COPY uncaught-heroes-backend/pom.xml /app/uncaught-heroes-backend
COPY uncaught-heroes-backend/src/ /app/uncaught-heroes-backend/src

RUN ls -la

EXPOSE 8080
EXPOSE 12345

ENV REBEL_HOME="/opt/jrebel"
ENV JAVA_OPTS="-agentpath:$REBEL_HOME/lib/libjrebel64.so -Drebel.remoting_plugin=true -Drebel.remoting_port=12345 $JAVA_OPTS"

RUN ./mvnw package -pl uncaught-heroes-backend

CMD ["sh", "-c", "java $JAVA_OPTS -jar uncaught-heroes-backend/target/uncaught-heroes-backend.jar"]